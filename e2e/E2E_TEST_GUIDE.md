# E2Eテスト実行ガイド

## テストファイル一覧

### 1. `glossary-feature.spec.ts` - 用語解説機能のテスト
用語にアンダーラインが表示され、クリックでポップアップが表示されることを確認します。

**テストケース:**
- 用語にアンダーラインが表示される
- 用語をクリックするとポップアップが表示される
- ポップアップに用語の説明が表示される
- ポップアップを閉じることができる（×ボタン、ESCキー、外部クリック）
- キーボードで用語にフォーカスできる

### 2. `placeholder-content.spec.ts` - プレースホルダーコンテンツのテスト
MDXファイルが存在しない場合にプレースホルダーコンテンツが表示されることを確認します。

**テストケース:**
- MDXファイルが存在しない場合、プレースホルダーコンテンツが表示される
- プレースホルダーコンテンツにレッスン情報が表示される
- プレースホルダーコンテンツからコース一覧に戻れる
- プレースホルダーコンテンツからダッシュボードに戻れる

### 3. `lesson-view-flow.spec.ts` - レッスン閲覧フローのテスト（更新済み）
認証が無効化されているため、認証フローをスキップしてテストします。

**テストケース:**
- コース一覧からコース詳細ページに移動できる
- コース詳細ページからレッスンページに移動できる
- レッスンコンテンツ（MDX）またはプレースホルダーが表示される
- 前後レッスンへのナビゲーションリンクが表示される

## テストの実行方法

### 前提条件
開発サーバーが起動している必要があります。

```bash
# 開発サーバーを起動（別ターミナル）
npm run dev
```

### テスト実行

```bash
# すべてのe2eテストを実行
npm run test:e2e

# UIモードで実行（推奨・デバッグに便利）
npm run test:e2e:ui

# 特定のテストファイルのみ実行
npx playwright test e2e/glossary-feature.spec.ts

# 特定のテストケースのみ実行
npx playwright test -g "用語にアンダーラインが表示される"
```

### テストレポートの確認

```bash
# HTMLレポートを表示
npx playwright show-report
```

## トラブルシューティング

### ポート3000が既に使用されている

**エラー:**
```
Error: listen EPERM: operation not permitted 0.0.0.0:3000
```

**解決策:**
1. 開発サーバーが既に起動している場合は、`playwright.config.ts`の`reuseExistingServer: true`が設定されているため、既存のサーバーを再利用します
2. 別のプロセスがポート3000を使用している場合は、そのプロセスを終了するか、別のポートを使用してください

### テストがタイムアウトする

**解決策:**
1. 開発サーバーが正常に起動しているか確認
2. `playwright.config.ts`の`timeout`を延長
3. テスト内の`timeout`オプションを調整

### 用語が検出されない

**確認事項:**
1. MDXファイルに用語が含まれているか確認
2. `lib/data/glossary.ts`に用語が定義されているか確認
3. MDXシリアライザーが正しく動作しているか確認（ブラウザのコンソールで確認）

### プレースホルダーコンテンツが表示されない

**確認事項:**
1. MDXファイルが実際に存在しないか確認
2. エラーハンドリングが正しく動作しているか確認
3. `components/lessons/PlaceholderContent.tsx`が正しくインポートされているか確認

## テストのカバレッジ

### 現在のカバレッジ
- ✅ 用語解説機能（アンダーライン、ポップアップ、キーボード操作）
- ✅ プレースホルダーコンテンツ（MDXファイルが存在しない場合）
- ✅ レッスン閲覧フロー（認証無効化対応）
- ⏭️ レッスン完了機能（認証再有効化後に有効化）

### 今後の追加予定
- 章末課題機能のテスト（フェーズ2-B実装後）
- 理解度パーソナライズ機能のテスト（フェーズ2-C実装後）
- AIチャット機能のテスト（既存の`chat-flow.spec.ts`を更新）

## 注意事項

1. **認証が無効化されている**: 現在、認証機能が無効化されているため、認証関連のテストはスキップされています
2. **開発サーバーが必要**: テスト実行前に開発サーバーが起動している必要があります
3. **ネットワークアクセス**: 一部のテストはネットワークアクセスが必要な場合があります
