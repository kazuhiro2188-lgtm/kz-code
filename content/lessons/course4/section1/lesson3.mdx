# インデックス設計

## はじめに

このレッスンでは、**インデックス設計**について学びます。

## インデックスとは

**インデックス**は、データベースの検索性能を向上させるためのデータ構造です。本の索引のように、特定のデータを素早く見つけることができます。

### インデックスの仕組み

インデックスは、特定の列の値とその行の位置を対応付けるデータ構造です。

**例:**
```
テーブル: users
id | name | email
---|------|------
1  | Alice| alice@example.com
2  | Bob  | bob@example.com
3  | Carol| carol@example.com

インデックス（email列）:
email                | row_id
---------------------|-------
alice@example.com    | 1
bob@example.com      | 2
carol@example.com    | 3
```

## インデックスの種類

### B-treeインデックス

最も一般的なインデックスタイプです。

**特徴:**
- 等価検索、範囲検索に適している
- ソート済みデータに有効

### ハッシュインデックス

ハッシュテーブルを使用するインデックスです。

**特徴:**
- 等価検索に非常に高速
- 範囲検索には不向き

### 複合インデックス

複数の列を組み合わせたインデックスです。

**例:**
```sql
CREATE INDEX idx_user_email_name ON users(email, name);
```

## インデックス設計の原則

### 1. 頻繁に検索される列にインデックスを作成

```sql
-- よく検索される列
SELECT * FROM users WHERE email = 'alice@example.com';
-- → email列にインデックスを作成
```

### 2. JOINで使用される列にインデックスを作成

```sql
-- JOINで使用される列
SELECT * FROM orders o
JOIN users u ON o.user_id = u.id;
-- → user_id列にインデックスを作成
```

### 3. 過度なインデックスは避ける

インデックスは書き込み性能に影響を与えるため、必要なもののみを作成します。

## AI開発における適用

AI開発においても、インデックス設計は重要です：

- **プロンプト検索**: プロンプトID、テンプレート名にインデックス
- **実行履歴**: ユーザーID、実行日時にインデックス
- **ログ検索**: エラーコード、タイムスタンプにインデックス

## まとめ

- **インデックス**は検索性能を向上させる
- 頻繁に検索される列、JOINで使用される列にインデックスを作成
- 過度なインデックスは書き込み性能に影響するため、適切に設計する
